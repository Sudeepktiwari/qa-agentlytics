<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Scroll Detection Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            height: 200vh; /* Make page scrollable */
        }
        .content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .logs {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="content">
        <h1>üîß Widget Scroll Detection Fix Test</h1>
        
        <div class="test-section">
            <h2>Test Status</h2>
            <div id="test-status" class="status">
                ‚è≥ Loading widget...
            </div>
            
            <h3>Instructions:</h3>
            <ol>
                <li>Open browser console to check for errors</li>
                <li>Look for any "setupWidgetScrollDetection is not defined" errors</li>
                <li>If widget loads without errors, the fix is successful ‚úÖ</li>
                <li>Test scrolling and interaction to ensure scroll detection works</li>
            </ol>
        </div>

        <div class="test-section">
            <h2>Console Logs</h2>
            <div id="console-logs" class="logs">
                Monitoring console output...
            </div>
        </div>

        <div class="test-section">
            <h2>Widget Behavior Test</h2>
            <p>Once the widget loads:</p>
            <ul>
                <li>‚úÖ Open the chat widget</li>
                <li>‚úÖ Send a message</li>
                <li>‚úÖ Scroll within the chat widget</li>
                <li>‚úÖ Scroll on this page</li>
                <li>‚úÖ Check for followup messages</li>
            </ul>
            <p><strong>Expected behavior:</strong> All interactions should work without JavaScript errors.</p>
        </div>

        <!-- Add some content to make the page scrollable -->
        <div style="margin-top: 50px;">
            <h2>Scroll Test Content</h2>
            <p>Scroll down to test page scroll detection...</p>
            <div style="height: 500px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); margin: 20px 0; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                <h3>Scroll Test Area 1</h3>
            </div>
            <div style="height: 500px; background: linear-gradient(135deg, #e0e0e0, #d0d0d0); margin: 20px 0; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                <h3>Scroll Test Area 2</h3>
            </div>
            <div style="height: 500px; background: linear-gradient(225deg, #d0d0d0, #c0c0c0); margin: 20px 0; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                <h3>Scroll Test Area 3</h3>
            </div>
        </div>
    </div>

    <script>
        // Monitor console for errors
        const originalError = console.error;
        const originalLog = console.log;
        const logContainer = document.getElementById('console-logs');
        const statusContainer = document.getElementById('test-status');
        
        let errorCount = 0;
        let setupWidgetScrollDetectionError = false;
        
        function updateStatus() {
            if (setupWidgetScrollDetectionError) {
                statusContainer.className = 'status error';
                statusContainer.innerHTML = '‚ùå setupWidgetScrollDetection error detected!';
            } else if (errorCount > 0) {
                statusContainer.className = 'status error';
                statusContainer.innerHTML = `‚ö†Ô∏è ${errorCount} error(s) detected (check console)`;
            } else {
                statusContainer.className = 'status success';
                statusContainer.innerHTML = '‚úÖ Widget loaded successfully - no setupWidgetScrollDetection errors!';
            }
        }
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logContainer.textContent += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.error = function(...args) {
            const message = args.join(' ');
            addLog(message, 'error');
            
            if (message.includes('setupWidgetScrollDetection is not defined')) {
                setupWidgetScrollDetectionError = true;
                addLog('CRITICAL: setupWidgetScrollDetection error detected!', 'error');
            }
            
            errorCount++;
            updateStatus();
            originalError.apply(console, args);
        };
        
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('Widget') || message.includes('WIDGET')) {
                addLog(message, 'info');
            }
            originalLog.apply(console, args);
        };
        
        // Load the widget
        addLog('Loading widget...', 'info');
        
        setTimeout(() => {
            // Clean up any existing widgets
            document.querySelectorAll('[id*="chatbot"], [id*="widget"], [id*="appointy"]').forEach(el => el.remove());
            
            const script = document.createElement('script');
            script.src = 'http://localhost:3002/api/widget';
            script.setAttribute('data-api-key', 'ak_e9c3475fd9b9371577ab09f5a0a7fcd1c635ef055b7e66374ed424162d80c9ac');
            script.setAttribute('data-theme', 'blue');
            script.setAttribute('data-size', 'large');
            script.setAttribute('data-voice-enabled', 'false');
            script.setAttribute('data-auto-open-proactive', 'true');
            
            script.onload = () => {
                addLog('Widget script loaded successfully', 'info');
                setTimeout(() => {
                    updateStatus();
                }, 2000); // Wait 2 seconds to see if any errors occur
            };
            
            script.onerror = () => {
                addLog('Widget script failed to load', 'error');
                errorCount++;
                updateStatus();
            };
            
            document.head.appendChild(script);
        }, 500);
        
        // Test widget interactions after loading
        setTimeout(() => {
            addLog('Testing widget functionality...', 'info');
            
            // Check if widget elements exist
            const widgetButton = document.querySelector('[id*="appointy"]');
            if (widgetButton) {
                addLog('Widget button found - widget loaded successfully', 'info');
            } else {
                addLog('Widget button not found - widget may not have loaded', 'error');
                errorCount++;
            }
            
            updateStatus();
        }, 3000);
    </script>
</body>
</html>
