<!DOCTYPE html>
<html>
  <head>
    <title>Button Test</title>
  </head>
  <body>
    <h1>Button Display Test</h1>
    <p>This will test if buttons are being parsed and displayed correctly.</p>

    <div style="border: 1px solid #ccc; padding: 20px; margin: 20px 0">
      <h3>Test Case 1: API Response with buttons array</h3>
      <p>Message with buttons from API response:</p>
      <div id="test1"></div>
    </div>

    <div style="border: 1px solid #ccc; padding: 20px; margin: 20px 0">
      <h3>Test Case 2: Text with bullet points</h3>
      <p>Message with bullet points that should become buttons:</p>
      <div id="test2"></div>
    </div>

    <script>
      // Simulate the button extraction function
      function extractButtonsFromText(text) {
        if (!text) return [];

        console.log("[TEST] Extracting buttons from text:", text);

        let cleaned = text.replace(/^---+$/gm, "");
        cleaned = cleaned.replace(/\n{2,}/g, "\n");
        cleaned = cleaned.replace(
          /^\s*(#{1,3}\s*)?(Quick\s+Actions?|Action\s+Buttons?|Buttons?|Options?|Choose\s+from|Select|Available\s+Actions?)\s*:?\s*$/gim,
          ""
        );

        const lines = cleaned.split(/\r?\n/);
        const buttons = [];

        console.log("[TEST] Processing lines:", lines);

        for (const raw of lines) {
          const line = raw.trim();
          if (!line) continue;

          let label = null;

          const patterns = [
            /^[\s]*[•\-\*\u2022\u2013\u2014]\s*(.+)$/, // Bullets
            /^[\s]*\d+\.\s*(.+)$/, // Numbered
            /^\s*[\-\*\u2022]?\s*\[([^\]]+)\]\([^)]*\)/, // Markdown links
            /^\s*[\-\*\u2022]?\s*\[\s*\]\s*(.+)$/, // Checkboxes
          ];

          for (const pattern of patterns) {
            const match = line.match(pattern);
            if (match && match[1]) {
              label = match[1].trim();
              break;
            }
          }

          if (label) {
            label = label
              .replace(/^\*+|\*+$/g, "")
              .replace(/^_+|_+$/g, "")
              .replace(/^`+|`+$/g, "")
              .replace(/[.!?]*$/, "");

            if (label.length >= 3 && label.length <= 60) {
              buttons.push(label);
              console.log("[TEST] Added button:", label);
            } else {
              console.log("[TEST] Skipped (length):", label);
            }
          }

          if (buttons.length >= 6) break;
        }

        console.log("[TEST] Final extracted buttons:", buttons);
        return buttons;
      }

      // Test Case 1: API response with buttons array
      const apiResponse = {
        buttons: [
          "Explore Revenue Analysis",
          "View Customer Sentiment Trends",
          "Learn About Churn Forecasting",
        ],
      };

      console.log("=== TEST CASE 1 ===");
      console.log("API buttons:", apiResponse.buttons);

      const test1Div = document.getElementById("test1");
      if (apiResponse.buttons && apiResponse.buttons.length > 0) {
        test1Div.innerHTML =
          "<p><strong>Buttons found in API response:</strong></p>";
        apiResponse.buttons.forEach((button, i) => {
          const btn = document.createElement("button");
          btn.textContent = button;
          btn.style.cssText =
            "margin: 5px; padding: 8px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;";
          btn.onclick = () => alert("Button clicked: " + button);
          test1Div.appendChild(btn);
        });
      } else {
        test1Div.innerHTML =
          '<p style="color: red;">No buttons found in API response</p>';
      }

      // Test Case 2: Text with bullet points
      const textWithBullets = `Understanding revenue impact is crucial for strategic decisions. Here's how it benefits your team:

• Connect customer signals to revenue impact analysis, helping to prioritize actions.

• Identify trends and patterns in customer sentiment that affect revenue.

• Forecast churn risks by segment to ensure proactive strategies are in place.

• Use insights to drive strategic decisions with confidence and improve overall performance.`;

      console.log("=== TEST CASE 2 ===");
      const extractedButtons = extractButtonsFromText(textWithBullets);

      const test2Div = document.getElementById("test2");
      if (extractedButtons && extractedButtons.length > 0) {
        test2Div.innerHTML =
          "<p><strong>Buttons extracted from text:</strong></p>";
        extractedButtons.forEach((button, i) => {
          const btn = document.createElement("button");
          btn.textContent = button;
          btn.style.cssText =
            "margin: 5px; padding: 8px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;";
          btn.onclick = () => alert("Button clicked: " + button);
          test2Div.appendChild(btn);
        });
      } else {
        test2Div.innerHTML =
          '<p style="color: red;">No buttons extracted from text</p>';
      }
    </script>
  </body>
</html>
