<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fix Test - Repetitive Messages & Generic Buttons</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .problem-example {
        background: #fff3cd;
        border: 2px solid #ffc107;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }
      .solution-example {
        background: #d1ecf1;
        border: 2px solid #17a2b8;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }
      .message-bad {
        background: #f8d7da;
        color: #721c24;
        padding: 12px;
        border-radius: 6px;
        margin: 8px 0;
        border-left: 4px solid #dc3545;
      }
      .message-good {
        background: #d4edda;
        color: #155724;
        padding: 12px;
        border-radius: 6px;
        margin: 8px 0;
        border-left: 4px solid #28a745;
      }
      .button-bad {
        background: #f8d7da;
        color: #721c24;
        padding: 6px 12px;
        border-radius: 4px;
        margin: 3px;
        display: inline-block;
        font-size: 12px;
      }
      .button-good {
        background: #d4edda;
        color: #155724;
        padding: 6px 12px;
        border-radius: 4px;
        margin: 3px;
        display: inline-block;
        font-size: 12px;
      }
      .test-button {
        background: #007bff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
        font-size: 16px;
      }
      .test-button:hover {
        background: #0056b3;
      }
      .analysis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }
      .variety-score {
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
      }
      .excellent {
        background: #d4edda;
        color: #155724;
      }
      .poor {
        background: #f8d7da;
        color: #721c24;
      }
      .page-simulation {
        background: #e9ecef;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #6c757d;
      }
    </style>
  </head>
  <body>
    <h1>üîß Fix Test - Addressing Repetitive Messages & Generic Buttons</h1>
    <p>
      Testing the enhanced system to fix the specific issues you identified.
    </p>

    <div class="test-container">
      <h2>‚ùå Problems You Identified</h2>

      <div class="problem-example">
        <h3>üö´ Issue #1: Repetitive Message Openings</h3>
        <div class="message-bad">
          "Noticed you're exploring appointment scheduling options..."
        </div>
        <div class="message-bad">
          "Ready to streamline client management..."
        </div>
        <div class="message-bad">
          "Ready to streamline your client management..."
        </div>
        <div class="message-bad">
          "Ready to eliminate scheduling conflicts..."
        </div>
        <p>
          <strong>Problem:</strong> All start with "Ready to..." or similar
          patterns. Sounds robotic!
        </p>
      </div>

      <div class="problem-example">
        <h3>üö´ Issue #2: Generic, Similar Buttons</h3>
        <p>
          <strong
            >User mentioned buttons are "almost same" - they're not specific to
            page content or helpful for customer profiling.</strong
          >
        </p>
        <div class="button-bad">Learn More</div>
        <div class="button-bad">Get Started</div>
        <div class="button-bad">Contact Us</div>
        <br />
        <div class="button-bad">Pricing Options</div>
        <div class="button-bad">Free Trial</div>
        <div class="button-bad">Get Demo</div>
        <p>
          <strong>Problem:</strong> Generic buttons that don't use actual page
          features or profile customers!
        </p>
      </div>
    </div>

    <div class="test-container">
      <h2>‚úÖ Enhanced Solution</h2>

      <div class="solution-example">
        <h3>‚úÖ Fix #1: Truly Varied Message Openings</h3>
        <div class="message-good">
          "Save 15 hours weekly with automated client scheduling and instant
          payment processing."
        </div>
        <div class="message-good">
          "Growing your fitness studio? Join 500+ trainers who doubled bookings
          with smart automation."
        </div>
        <div class="message-good">
          "Handle 200+ weekly appointments effortlessly. Most studios see 40%
          less no-shows immediately."
        </div>
        <div class="message-good">
          "Curious how top fitness pros manage recurring clients without the
          scheduling headache?"
        </div>
        <p>
          <strong>Improvement:</strong> Different structures, tones, and
          approaches. Numbers, social proof, benefits, questions.
        </p>
      </div>

      <div class="solution-example">
        <h3>‚úÖ Fix #2: Page-Specific, Profiling Buttons</h3>
        <p><strong>Based on actual fitness scheduling page content:</strong></p>
        <div class="button-good">Class Scheduling</div>
        <div class="button-good">Personal Training</div>
        <div class="button-good">Multi-Location</div>
        <br />
        <div class="button-good">Solo Practice</div>
        <div class="button-good">Studio Chain</div>
        <div class="button-good">Franchise Setup</div>
        <p>
          <strong>Improvement:</strong> Specific to fitness industry, help
          identify business size and type!
        </p>
      </div>
    </div>

    <div class="test-container">
      <h2>üß™ Live Fix Testing</h2>
      <p>
        Test with simulated fitness scheduling page content to verify fixes:
      </p>

      <div class="page-simulation">
        <strong>Simulated Page Content:</strong><br />
        "Professional appointment scheduling for fitness studios. Features:
        class booking, personal training sessions, recurring appointments,
        payment processing, mobile app, multi-location management. Perfect for
        yoga studios, gyms, personal trainers, and fitness chains."
      </div>

      <button class="test-button" onclick="testFitnessPage()">
        üèãÔ∏è Test Fitness Scheduling Page
      </button>
      <button class="test-button" onclick="runVarietyAnalysis()">
        üìä Run 5-Message Variety Test
      </button>
      <button class="test-button" onclick="clearResults()">
        üßπ Clear Results
      </button>

      <div id="testResults"></div>
      <div id="varietyAnalysis"></div>
    </div>

    <div class="test-container">
      <h2>üéØ What the Enhanced System Should Do</h2>

      <div class="analysis-grid">
        <div>
          <h3>üìù Message Variety Requirements</h3>
          <ul>
            <li>
              <strong>Different Openings:</strong> Numbers, questions, benefits,
              social proof
            </li>
            <li>
              <strong>Varied Structures:</strong> Short statements, questions,
              benefit-focused
            </li>
            <li>
              <strong>Specific Content:</strong> Reference actual page features
            </li>
            <li>
              <strong>No Repetition:</strong> Track and avoid repeated patterns
            </li>
          </ul>
        </div>

        <div>
          <h3>üéõÔ∏è Button Profiling Goals</h3>
          <ul>
            <li>
              <strong>Business Size:</strong> "Solo Practice" vs "Studio Chain"
            </li>
            <li>
              <strong>Service Type:</strong> "Class Booking" vs "Personal
              Training"
            </li>
            <li>
              <strong>Features:</strong> Actual page features like "Payment
              Processing"
            </li>
            <li>
              <strong>Industry Specific:</strong> "Yoga Studios" vs "Gyms" vs
              "Trainers"
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="test-container">
      <h2>üîç Expected Results vs Actual</h2>

      <h3>‚úÖ Expected for Fitness Scheduling Page:</h3>
      <div class="solution-example">
        <strong>Message Examples:</strong>
        <ul>
          <li>
            "Handle 200+ weekly fitness appointments with zero scheduling
            conflicts."
          </li>
          <li>
            "Growing your studio? Most fitness pros save 15 hours weekly with
            automated booking."
          </li>
          <li>
            "Join 500+ trainers who doubled client retention with smart
            scheduling."
          </li>
        </ul>

        <strong>Button Examples:</strong>
        <div class="button-good">Class Scheduling</div>
        <div class="button-good">Personal Training</div>
        <div class="button-good">Payment Setup</div>
        <br />
        <div class="button-good">Solo Trainer</div>
        <div class="button-good">Fitness Studio</div>
        <div class="button-good">Gym Chain</div>
      </div>
    </div>

    <script>
      let testHistory = [];

      async function testFitnessPage() {
        const resultsDiv = document.getElementById("testResults");
        resultsDiv.innerHTML =
          "<p>üîÑ Testing fitness scheduling page with enhanced system...</p>";

        try {
          const response = await fetch("/api/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              messages: [
                {
                  role: "user",
                  content:
                    "I need help with appointment scheduling for my fitness business",
                },
              ],
              adminId: "test-admin",
              url: "https://example-fitness.com/scheduling",
              metadata: {
                title: "Professional Fitness Appointment Scheduling",
                description:
                  "Appointment scheduling for fitness studios. Features: class booking, personal training sessions, recurring appointments, payment processing, mobile app, multi-location management. Perfect for yoga studios, gyms, personal trainers, and fitness chains.",
              },
            }),
          });

          const data = await response.json();
          testHistory.push(data);

          // Analyze for issues
          const message = data.mainText || "No message generated";
          const buttons = data.buttons || [];

          const hasRepetitiveStart =
            message.toLowerCase().startsWith("ready to") ||
            message.toLowerCase().startsWith("noticed you") ||
            message.toLowerCase().startsWith("looking to");

          const hasGenericButtons = buttons.some((btn) =>
            [
              "learn more",
              "get started",
              "contact us",
              "pricing options",
            ].includes(btn.toLowerCase())
          );

          const hasSpecificFeatures = buttons.some((btn) =>
            ["class", "training", "payment", "mobile", "studio", "gym"].some(
              (feature) => btn.toLowerCase().includes(feature)
            )
          );

          resultsDiv.innerHTML = `
                    <div class="solution-example">
                        <h3>üìã Test Results</h3>
                        <div class="${
                          hasRepetitiveStart ? "message-bad" : "message-good"
                        }">
                            <strong>Generated Message:</strong><br>
                            ${message}
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Generated Buttons:</strong><br>
                            ${buttons
                              .map(
                                (btn) =>
                                  `<span class="${
                                    hasGenericButtons &&
                                    [
                                      "learn more",
                                      "get started",
                                      "contact us",
                                    ].includes(btn.toLowerCase())
                                      ? "button-bad"
                                      : "button-good"
                                  }">${btn}</span>`
                              )
                              .join(" ")}
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0;">
                            <strong>Quality Analysis:</strong><br>
                            ‚Ä¢ Repetitive opening: ${
                              hasRepetitiveStart
                                ? "‚ùå Yes (needs fixing)"
                                : "‚úÖ No"
                            }<br>
                            ‚Ä¢ Generic buttons: ${
                              hasGenericButtons
                                ? "‚ùå Yes (needs fixing)"
                                : "‚úÖ No"
                            }<br>
                            ‚Ä¢ Specific features: ${
                              hasSpecificFeatures
                                ? "‚úÖ Yes"
                                : "‚ùå No (needs fixing)"
                            }<br>
                            ‚Ä¢ Page relevance: ${
                              message.toLowerCase().includes("fitness") ||
                              message.toLowerCase().includes("appointment")
                                ? "‚úÖ Good"
                                : "‚ùå Poor"
                            }
                        </div>
                    </div>
                `;
        } catch (error) {
          resultsDiv.innerHTML += `<div class="message-bad">‚ùå Test Error: ${error.message}</div>`;
        }
      }

      async function runVarietyAnalysis() {
        const analysisDiv = document.getElementById("varietyAnalysis");
        analysisDiv.innerHTML =
          "<p>üîÑ Running 5-message variety analysis...</p>";

        const messages = [];
        const buttonSets = [];

        try {
          for (let i = 0; i < 5; i++) {
            const response = await fetch("/api/chat", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                messages: [
                  {
                    role: "user",
                    content: `Fitness scheduling inquiry ${i + 1}`,
                  },
                ],
                adminId: "test-admin",
                url: "https://example-fitness.com/features",
                metadata: {
                  title: "Fitness Studio Management Features",
                  description:
                    "Class scheduling, personal training booking, payment processing, member management, mobile app access, multi-location support",
                },
              }),
            });

            const data = await response.json();
            messages.push(data.mainText || "No message");
            buttonSets.push(data.buttons || []);

            await new Promise((resolve) => setTimeout(resolve, 1000));
          }

          // Analyze variety
          const openingWords = messages.map((msg) =>
            msg.split(" ")[0].toLowerCase()
          );
          const uniqueOpenings = new Set(openingWords).size;
          const varietyScore = (uniqueOpenings / messages.length) * 100;

          const repetitiveCount = messages.filter(
            (msg) =>
              msg.toLowerCase().startsWith("ready to") ||
              msg.toLowerCase().startsWith("noticed you") ||
              msg.toLowerCase().startsWith("looking to")
          ).length;

          // Analyze button variety
          const allButtons = buttonSets.flat();
          const uniqueButtons = new Set(
            allButtons.map((btn) => btn.toLowerCase())
          ).size;
          const buttonVariety =
            allButtons.length > 0
              ? (uniqueButtons / allButtons.length) * 100
              : 0;

          let scoreClass =
            varietyScore >= 80 && repetitiveCount === 0 ? "excellent" : "poor";

          analysisDiv.innerHTML = `
                    <div class="variety-score ${scoreClass}">
                        Variety Score: ${varietyScore.toFixed(
                          0
                        )}% | Repetitive Openings: ${repetitiveCount}/5
                    </div>
                    
                    <div class="analysis-grid">
                        <div>
                            <h4>üìù Generated Messages:</h4>
                            ${messages
                              .map(
                                (msg, i) =>
                                  `<div class="message-${
                                    msg.toLowerCase().startsWith("ready to") ||
                                    msg.toLowerCase().startsWith("noticed")
                                      ? "bad"
                                      : "good"
                                  }">
                                    ${i + 1}. ${msg}
                                </div>`
                              )
                              .join("")}
                        </div>
                        
                        <div>
                            <h4>üéõÔ∏è Generated Buttons:</h4>
                            ${buttonSets
                              .map(
                                (buttons, i) =>
                                  `<div style="margin: 10px 0;">
                                    <strong>${i + 1}:</strong> ${buttons
                                    .map(
                                      (btn) =>
                                        `<span class="button-${
                                          [
                                            "learn more",
                                            "get started",
                                            "contact us",
                                          ].includes(btn.toLowerCase())
                                            ? "bad"
                                            : "good"
                                        }">${btn}</span>`
                                    )
                                    .join(" ")}
                                </div>`
                              )
                              .join("")}
                            
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0;">
                                <strong>Button Variety:</strong> ${buttonVariety.toFixed(
                                  0
                                )}%<br>
                                <strong>Unique Buttons:</strong> ${uniqueButtons}/${
            allButtons.length
          }
                            </div>
                        </div>
                    </div>
                `;
        } catch (error) {
          analysisDiv.innerHTML += `<div class="message-bad">‚ùå Analysis Error: ${error.message}</div>`;
        }
      }

      function clearResults() {
        document.getElementById("testResults").innerHTML = "";
        document.getElementById("varietyAnalysis").innerHTML = "";
        testHistory = [];
      }
    </script>
  </body>
</html>
